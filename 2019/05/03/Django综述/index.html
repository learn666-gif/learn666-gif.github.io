<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">


<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>





<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "1da5edcb"
    });
  daovoice('update');
  </script>














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Django," />





  <link rel="alternate" href="/atom.xml" title="jwangcloud" type="application/atom+xml" />






<meta name="description" content="简介主要内容： Django运用、序列化、前后端分离、数据库连接、token头、数据交互 更新： 不定期更新，遇到相关问题则会添加到其中，若有问题请留言或者右下角直接联系">
<meta property="og:type" content="article">
<meta property="og:title" content="Django综述">
<meta property="og:url" content="https://github.com/learn666-gif/2019/05/03/Django%E7%BB%BC%E8%BF%B0/index.html">
<meta property="og:site_name" content="jwangcloud">
<meta property="og:description" content="简介主要内容： Django运用、序列化、前后端分离、数据库连接、token头、数据交互 更新： 不定期更新，遇到相关问题则会添加到其中，若有问题请留言或者右下角直接联系">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_1.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_2.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_3.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_4.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_5.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_6.png">
<meta property="og:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter2_1.png">
<meta property="article:published_time" content="2019-05-03T10:01:17.000Z">
<meta property="article:modified_time" content="2020-03-05T09:50:23.955Z">
<meta property="article:author" content="Jwang">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/learn666-gif/2019/05/03/Django综述/"/>





  <title>Django综述 | jwangcloud</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
   
    <a href="https://github.com/learn666-gif" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
 
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jwangcloud</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/learn666-gif/2019/05/03/Django%E7%BB%BC%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jwang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jwangcloud">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Django综述</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-03T18:01:17+08:00">
                2019-05-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">python编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  33
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>主要内容： Django运用、序列化、前后端分离、数据库连接、token头、数据交互</p>
<p>更新： 不定期更新，遇到相关问题则会添加到其中，若有问题请留言或者右下角直接联系</p>
<a id="more"></a>

<h2 id="虚拟环境安装"><a href="#虚拟环境安装" class="headerlink" title="虚拟环境安装"></a>虚拟环境安装</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>安装python虚拟环境</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenv</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenvwrapper</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install virtualenvwrapper-win (windows系列)</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> WORKON_HOME=~/Envs</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p <span class="variable">$WORKON_HOME</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /usr/<span class="built_in">local</span>/bin/virtualenvwrapper.sh</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>虚拟环境位置文档位置</p>
</blockquote>
<blockquote>
<p><a href="https://virtualenvwrapper.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://virtualenvwrapper.readthedocs.io/en/latest/</a></p>
</blockquote>
<ul>
<li>注意点 virtualenv是初级的工具 只能用在你当前文件夹的目录下面去新建</li>
<li>wrapper所带的 mkvirtualenv 和 workon命令可以让你在任何地方管理虚拟环境 不用考虑文件夹位置</li>
</ul>
</li>
<li><p>新建一个虚拟环境 激活虚拟环境 并且安装django 查看安装的django版本</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">virtualenv</span> <span class="string">ruimi_django -p python3.6</span></span><br><span class="line"><span class="attr">source</span> <span class="string">ruimi_django/bin/activate</span></span><br><span class="line"><span class="attr">pip</span> <span class="string">install django==1.11</span></span><br><span class="line"><span class="attr">python</span> <span class="string">-m django --version</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>pycharm安装django环境</p>
<ol>
<li><p>在pycharm中选择newproject django</p>
</li>
<li><p>选择虚拟环境(你在本地建好的虚拟环境)</p>
</li>
<li><p>点击create,新建成功<br><img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_1.png" alt=""></p>
<p><img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_2.png" alt=""></p>
</li>
</ol>
</li>
<li><p>命令行安装django</p>
<ol>
<li><p>使用命令行创建django 效果等同于pycharm 其实pycharm的原理就是去帮你执行这些命令而已</p>
</li>
<li><p>我们需要先切换到有django的虚拟环境才行</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> django-admin startproject <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>


</li>
</ol>
</li>
</ul>
<h3 id="通过django创建第一个app"><a href="#通过django创建第一个app" class="headerlink" title="通过django创建第一个app"></a>通过django创建第一个app</h3><ul>
<li><p>通过django 创建第一个app</p>
  <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">django-admin startapp movies</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>有两个djano_mvc_ppt 第一个是总目录 第二个djano_mvc_ppt是项目的配置目录 settings urls 路由就在里面。他是定义整个项目的配置路由等。</p>
</blockquote>
<blockquote>
<p>我们刚才新建的是app目录是单独的功能目录,比如用户信息就可以新建一个目录来表示。在app目录里面我们去定义视图,模型等等。这个在后面章节会讲到。</p>
</blockquote>
</li>
<li><p>启动django</p>
<ol>
<li><p>命令行来启动django </p>
<ol>
<li><p>python必须是我们的django环境里面的python程序</p>
</li>
<li><p>manage.py是我们django项目目录下面的manage.py</p>
</li>
<li><p>runserver是启动django 后台服务的命令 后面跟上ip和端口即可</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python</span> <span class="selector-tag">manage</span><span class="selector-class">.py</span> <span class="selector-tag">runserver</span> 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-pseudo">:8000</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>pycharm 启动django项目<br> <img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_3.png" alt=""></p>
<ol>
<li><p>debug模式, 使用debug模式启动django,我们可以打断点,程序过来以后,就能截取到值</p>
</li>
<li><p>run 模式,那么程序只会执行,不会有断点查看功能</p>
</li>
<li><p>最后 我们可以在下方 看到运行的状态<br><img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_4.png" alt=""></p>
<ol start="4">
<li>启动完成后我们就可以查看启动是否成功了        <img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_5.png" alt=""></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="为什么使用1-11版本"><a href="#为什么使用1-11版本" class="headerlink" title="为什么使用1.11版本"></a>为什么使用1.11版本</h3><ol>
<li><p>2.0版本的lts(long time serve)目前还没有出来,到2019年我们就可以顺利使用django 2.0啦</p>
<p> <img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter1_6.png" alt=""></p>
</li>
</ol>
<h2 id="apps详解"><a href="#apps详解" class="headerlink" title="apps详解"></a>apps详解</h2><h3 id="apps和整体配置文件内部结构"><a href="#apps和整体配置文件内部结构" class="headerlink" title="apps和整体配置文件内部结构"></a>apps和整体配置文件内部结构</h3><ul>
<li><p>最外部的manage.py</p>
<p>  一个命令行工具,实现django各种功能的文件,比如数据库迁移,静态文件收集,启动django服务等等</p>
</li>
<li><p>首先我们来查看一下 djano_mvc_ppt的结构</p>
<ol>
<li><code>\__init__.py</code> 它告诉Python这个目录应该被看做一个Python包</li>
<li><code>settings.py</code> 项目的整体配置文件,包含项目启动哪些app,中间件设置,第三方包配置等等都在里面</li>
<li><code>urls.py</code> 总路由配置文件</li>
<li><code>wsgi.py</code> 网关协议入口程序</li>
</ol>
</li>
</ul>
<ul>
<li><p>apps的结构</p>
<blockquote>
<p>migrations 文件夹,数据库迁移记录文件</p>
</blockquote>
<blockquote>
<p>init.py apps 初始化文件 一般为空即</p>
</blockquote>
<blockquote>
<p>admin.py 自定义admin后台管理的地方</p>
</blockquote>
<blockquote>
<p>apps.py app的在项目注册的名称,默认就行了</p>
</blockquote>
<blockquote>
<p>models.py 定义数据模型</p>
</blockquote>
<blockquote>
<p>tests.py 单元测试地址</p>
</blockquote>
<blockquote>
<p>views.py 视图</p>
</blockquote>
</li>
</ul>
<h3 id="第一个简单页面"><a href="#第一个简单页面" class="headerlink" title="第一个简单页面"></a>第一个简单页面</h3><ul>
<li><p>movies/views.py</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world!"</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>djano_mvc_ppt/urls.py    </p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="keyword">from</span> movies.views <span class="keyword">import</span> test1</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    </span><br><span class="line">    url(<span class="string">r'^test1$'</span>,test1)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问 <a href="http://127.0.0.1:8000/test1" target="_blank" rel="noopener">http://127.0.0.1:8000/test1</a><br>  <img src="https://jwangblog.oss-cn-chengdu.aliyuncs.com/md_pics/chapter2_1.png" alt=""></p>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3></li>
</ul>
<ol>
<li>views 是我们视图函数 他们负责给用户返回什么样的信息</li>
<li>url 是路由,试想一个网站有不同的页面,怎么样来走到不同的页面,就是通过这的路由分发来做的。我们把test1的网站转发到我们的views.py里面的test1函数</li>
<li>终上所述,我们在访问页面的时候,就得到了第一个页面</li>
</ol>
<h3 id="第二个页面"><a href="#第二个页面" class="headerlink" title="第二个页面"></a>第二个页面</h3><ol>
<li><p>我们知道,百度等网页是复杂的html构成的,所以我们需要前端人员的html网页支持,django可以渲染出前端的html网页,使用render</p>
<blockquote>
<p>movies/views.py</p>
</blockquote>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">(request)</span>:</span></span><br><span class="line">	</span><br><span class="line">   <span class="keyword">return</span> render(request,<span class="string">'movies/index.html'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>djano_mvc_ppt/urls.py    </p>
</blockquote>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="keyword">from</span> movies.views <span class="keyword">import</span> test2</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    </span><br><span class="line">    url(<span class="string">r'^test2$'</span>,test2)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>templates/movies/index.html</p>
</blockquote>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;hello html&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h3><blockquote>
<p>django可以通过一定的方式,把html网页送给浏览器,这时候就不需要我们去直接回复一个字符串</p>
</blockquote>
<h3 id="第三个页面"><a href="#第三个页面" class="headerlink" title="第三个页面"></a>第三个页面</h3><ul>
<li><p>movies/models.py</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">11</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>djano_mvc_ppt/settings.py</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'movies'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py makemigrations</span><br><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>movies/views.py</p>
</blockquote>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test3</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> movies.models <span class="keyword">import</span> Test</span><br><span class="line">    user = Test.objects.all()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'movies/index2.html'</span>,context=&#123;<span class="string">'name'</span>:user.name&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>templates/movies/index2.html</p>
</blockquote>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;hello {{ name }}&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></li>
</ul>
<h3 id="解释-2"><a href="#解释-2" class="headerlink" title="解释"></a>解释</h3><ol>
<li><p>model可以直接操控数据库,我们不用去写sql语句了,使用对象实例化就可以获取到语句</p>
</li>
<li><p>views可以把数据库传递给html,我们称为模板渲染,因为不是html语法,他需要python去加工一下(渲染)</p>
</li>
</ol>
<h2 id="mtv模式"><a href="#mtv模式" class="headerlink" title="mtv模式"></a>mtv模式</h2><h3 id="解释-3"><a href="#解释-3" class="headerlink" title="解释"></a>解释</h3><p>我们上述的模式就是mtv模式</p>
<ol>
<li>views专门负责取出数据来,怎么取,取多少数据都在views里面</li>
<li>model专门负责数据库控制,数据库字段怎么定义,这些字段代表什么就是model.py做的事情</li>
<li>html文件负责页面的展现,css js等都写在里面,他就专门负责页面怎么美观就行了</li>
</ol>
<h3 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h3><p>以上就是我们框架的基本模式,主要的思想就是各司其职,分层</p>
<h2 id="函数视图"><a href="#函数视图" class="headerlink" title="函数视图"></a>函数视图</h2><h3 id="基础视图分析"><a href="#基础视图分析" class="headerlink" title="基础视图分析"></a>基础视图分析</h3><ul>
<li><p>request 里面有所有的信息,他的信息是我们的wsgi解析之后的报文,回想一下http协议,他所有的信息都在报文里面,是一个很长的字符串,但是我们看到的request里面是dict和object,说明django框架已经帮我们解析好了报文里面的信息</p>
</li>
<li><p>HttpResponse是django帮我们封装响应报文,返回我们想给浏览器返回的信息,当然也有其他的返回值,他们都是django帮我们封装好的</p>
<pre><code>Http404
HttpResponseForbidden
...</code></pre><blockquote>
<p>movies/views.py</p>
</blockquote>
<pre><code>def test1(request):
    return HttpResponse(&quot;Hello, world!&quot;)</code></pre></li>
</ul>
<h3 id="快捷函数"><a href="#快捷函数" class="headerlink" title="快捷函数"></a>快捷函数</h3><ul>
<li><p>我们来写一个能够渲染模板的函数,那么他需要使用HttpResponse来给用户返回信息</p>
<blockquote>
<p>movies/views.py</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test5</span><span class="params">(request)</span>:</span></span><br><span class="line">	  <span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line">	  t = loader.get_template(<span class="string">'movies/index.html'</span>)</span><br><span class="line">	  <span class="keyword">return</span> HttpResponse(t.render(&#123;&#125;,request))</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果我们觉得这样写很麻烦,那么我们可以使用快捷函数 render来帮我们做这个事情,凡是在 from django.shortcuts 中定义的函数,都是帮我们快捷的完成一些功能的函数</p>
<blockquote>
<p>movies/views.py</p>
</blockquote>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">(request)</span></span><span class="symbol">:</span></span><br><span class="line">	 <span class="keyword">return</span> render(request,<span class="string">'movies/index.html'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看一下render的源码,我们发现 其实就是我们刚才的原始函数,不过他帮我们做了一层封装</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(request, template_name, context=None, </span></span></span><br><span class="line"><span class="function"><span class="params">	content_type=None, status=None, using=None)</span>:</span></span><br><span class="line">	<span class="string">"""</span></span><br><span class="line"><span class="string">	Returns a HttpResponse whose content is filled with the </span></span><br><span class="line"><span class="string">		result of calling</span></span><br><span class="line"><span class="string">	django.template.loader.render_to_string() with the passed </span></span><br><span class="line"><span class="string">		arguments.</span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	content = loader.render_to_string(template_name, context, </span><br><span class="line">		request, using=using)</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(content, content_type, status)</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他快捷函数</p>
<ol>
<li><p>redirec 重定向,在访问一个网页的时候,帮助我们重定向</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test6</span><span class="params">(request)</span>:</span></span><br><span class="line">  		<span class="keyword">return</span> redirect(<span class="string">'https://www.baidu.com'</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>get_object_or_404 帮助我们查找数据,如果没有数据则返回404的错误</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test7</span><span class="params">(request)</span>:</span></span><br><span class="line">	obj = get_object_or_404(Test,pk=<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(obj.name)</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><ul>
<li>使用装饰器去控制函数视图的行为 </li>
</ul>
<pre><code>    from django.views.decorators.http import
                        require_http_methods
    @require_http_methods([&apos;GET&apos;])
    def test8(request):
        return HttpResponse(&apos;hello&apos;)


1. require_http_methods 控制行为,list传递
2. require_GET get行为
3. require_POST() post行为</code></pre><h3 id="类视图"><a href="#类视图" class="headerlink" title="类视图"></a>类视图</h3><pre><code>&gt;lietview
&gt;
&gt;deleteview</code></pre><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="CSRF概念"><a href="#CSRF概念" class="headerlink" title="CSRF概念"></a>CSRF概念</h3><ol>
<li>全称: CSRF跨站点请求伪造(Cross—Site Request Forgery)</li>
<li>解释: 攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中Web A为存在CSRF漏洞的网站，Web B为攻击者构建的恶意网站，User C为Web A网站的合法用户。</li>
</ol>
<h3 id="CSRF攻击攻击原理及过程"><a href="#CSRF攻击攻击原理及过程" class="headerlink" title="CSRF攻击攻击原理及过程"></a>CSRF攻击攻击原理及过程</h3><ol>
<li><p>用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；</p>
</li>
<li><p>在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；</p>
</li>
<li><p>用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；</p>
</li>
<li><p>网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；</p>
</li>
</ol>
<ol start="5">
<li>浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。 </li>
</ol>
<h3 id="CSRF攻击实例"><a href="#CSRF攻击实例" class="headerlink" title="CSRF攻击实例"></a>CSRF攻击实例</h3><ul>
<li><p>攻击</p>
<p>  受害者 Bob 在银行有一笔存款，通过对银行的网站发送请求 <a href="http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=bob2" target="_blank" rel="noopener">http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=bob2</a> 可以使 Bob 把 1000000 的存款转到 bob2 的账号下。通常情况下，该请求发送到网站后，服务器会先验证该请求是否来自一个合法的 session，并且该 session 的用户 Bob 已经成功登陆。</p>
<p>  黑客 Mallory 自己在该银行也有账户，他知道上文中的 URL 可以把钱进行转帐操作。Mallory 可以自己发送一个请求给银行：<a href="http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory。但是这个请求来自" target="_blank" rel="noopener">http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory。但是这个请求来自</a> Mallory 而非 Bob，他不能通过安全认证，因此该请求不会起作用。</p>
<p>  这时，Mallory 想到使用 CSRF 的攻击方式，他先自己做一个网站，在网站中放入如下代码： src=”<a href="http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory" target="_blank" rel="noopener">http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory</a> ”，并且通过广告等诱使 Bob 来访问他的网站。当 Bob 访问该网站时，上述 url 就会从 Bob 的浏览器发向银行，而这个请求会附带 Bob 浏览器中的 cookie 一起发向银行服务器。大多数情况下，该请求会失败，因为他要求 Bob 的认证信息。但是，如果 Bob 当时恰巧刚访问他的银行后不久，他的浏览器与银行网站之间的 session 尚未过期，浏览器的 cookie 之中含有 Bob 的认证信息。这时，悲剧发生了，这个 url 请求就会得到响应，钱将从 Bob 的账号转移到 Mallory 的账号，而 Bob 当时毫不知情。等以后 Bob 发现账户钱少了，即使他去银行查询日志，他也只能发现确实有一个来自于他本人的合法请求转移了资金，没有任何被攻击的痕迹。而 Mallory 则可以拿到钱后逍遥法外。</p>
</li>
</ul>
<h3 id="防御CSRF攻击"><a href="#防御CSRF攻击" class="headerlink" title="防御CSRF攻击"></a>防御CSRF攻击</h3><ul>
<li><p>目前防御 CSRF 攻击主要有三种策略：验证 HTTP Referer 字段；在请求地址中添加 token 并验证；在 HTTP 头中自定义属性并验证。</p>
</li>
<li><p>（1）验证 HTTP Referer 字段</p>
<p> 根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限页面的请求来自于同一个网站，比如需要访问 <a href="http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory，用户必须先登陆" target="_blank" rel="noopener">http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory，用户必须先登陆</a> bank.example，然后通过点击页面上的按钮来触发转账事件。这时，该转帐请求的 Referer 值就会是转账按钮所在的页面的 URL，通常是以 bank.example 域名开头的地址。而如果黑客要对银行网站实施 CSRF 攻击，他只能在他自己的网站构造请求，当用户通过黑客的网站发送请求到银行时，该请求的 Referer 是指向黑客自己的网站。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值，如果是以 bank.example 开头的域名，则说明该请求是来自银行网站自己的请求，是合法的。如果 Referer 是其他网站的话，则有可能是黑客的 CSRF 攻击，拒绝该请求。</p>
<p> 这种方法的显而易见的好处就是简单易行，网站的普通开发人员不需要操心 CSRF 的漏洞，只需要在最后给所有安全敏感的请求统一增加一个拦截器来检查 Referer 的值就可以。特别是对于当前现有的系统，不需要改变当前系统的任何已有代码和逻辑，没有风险，非常便捷。</p>
<p> 然而，这种方法并非万无一失。Referer 的值是由浏览器提供的，虽然 HTTP 协议上有明确的要求，但是每个浏览器对于 Referer 的具体实现可能有差别，并不能保证浏览器自身没有安全漏洞。使用验证 Referer 值的方法，就是把安全性都依赖于第三方（即浏览器）来保障，从理论上来讲，这样并不安全。事实上，对于某些浏览器，比如 IE6 或 FF2，目前已经有一些方法可以篡改 Referer 值。如果 bank.example 网站支持 IE6 浏览器，黑客完全可以把用户浏览器的 Referer 值设为以 bank.example 域名开头的地址，这样就可以通过验证，从而进行 CSRF 攻击。</p>
<p> 即便是使用最新的浏览器，黑客无法篡改 Referer 值，这种方法仍然有问题。因为 Referer 值会记录下用户的访问来源，有些用户认为这样会侵犯到他们自己的隐私权，特别是有些组织担心 Referer 值会把组织内网中的某些信息泄露到外网中。因此，用户自己可以设置浏览器使其在发送请求时不再提供 Referer。当他们正常访问银行网站时，网站会因为请求没有 Referer 值而认为是 CSRF 攻击，拒绝合法用户的访问。</p>
</li>
<li><p>（2）在请求地址中添加 token 并验证</p>
<p>  CSRF 攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于 cookie 中，因此黑客可以在不知道这些验证信息的情况下直接利用用户自己的 cookie 来通过安全验证。要抵御 CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于 cookie 之中。可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这个 token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。</p>
<p>  这种方法要比检查 Referer 要安全一些，token 可以在用户登陆后产生并放于 session 之中，然后在每次请求时把 token 从 session 中拿出，与请求中的 token 进行比对，但这种方法的难点在于如何把 token 以参数的形式加入请求。对于 GET 请求，token 将附在请求地址之后，这样 URL 就变成 <a href="http://url?csrftoken=tokenvalue。" target="_blank" rel="noopener">http://url?csrftoken=tokenvalue。</a> 而对于 POST 请求来说，要在 form 的最后加上 <input type=”hidden” name=”csrftoken” value=”tokenvalue”/>，这样就把 token 以参数的形式加入请求了。但是，在一个网站中，可以接受请求的地方非常多，要对于每一个请求都加上 token 是很麻烦的，并且很容易漏掉，通常使用的方法就是在每次页面加载时，使用 javascript 遍历整个 dom 树，对于 dom 中所有的 a 和 form 标签后加入 token。这样可以解决大部分的请求，但是对于在页面加载之后动态生成的 html 代码，这种方法就没有作用，还需要程序员在编码时手动添加 token。</p>
<p>  该方法还有一个缺点是难以保证 token 本身的安全。特别是在一些论坛之类支持用户自己发表内容的网站，黑客可以在上面发布自己个人网站的地址。由于系统也会在这个地址后面加上 token，黑客可以在自己的网站上得到这个 token，并马上就可以发动 CSRF 攻击。为了避免这一点，系统可以在添加 token 的时候增加一个判断，如果这个链接是链到自己本站的，就在后面添加 token，如果是通向外网则不加。不过，即使这个 csrftoken 不以参数的形式附加在请求之中，黑客的网站也同样可以通过 Referer 来得到这个 token 值以发动 CSRF 攻击。这也是一些用户喜欢手动关闭浏览器 Referer 功能的原因。</p>
</li>
<li><p>（3）在 HTTP 头中自定义属性并验证</p>
<p>  这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。</p>
<p>  然而这种方法的局限性非常大。XMLHttpRequest 请求通常用于 Ajax 方法中对于页面局部的异步刷新，并非所有的请求都适合用这个类来发起，而且通过该类请求得到的页面不能被浏览器所记录下，从而进行前进，后退，刷新，收藏等操作，给用户带来不便。另外，对于没有进行 CSRF 防护的遗留系统来说，要采用这种方法来进行防护，要把所有请求都改为 XMLHttpRequest 请求，这样几乎是要重写整个网站，这代价无疑是不能接受的。</p>
</li>
</ul>
<h2 id="Form表单"><a href="#Form表单" class="headerlink" title="Form表单"></a>Form表单</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>django的form有两个功能,第一个是帮助我们生成表单,在html里面,第二个功能是帮我们验证表单</p>
<h3 id="生成表单"><a href="#生成表单" class="headerlink" title="生成表单"></a>生成表单</h3><ul>
<li><p>首先我们会在一个外部的forms.py文件里面建立我们的表单类,在这个类的定义的字段会直接显示在html里面,我们不用在html里面去写input标签</p>
<blockquote>
<p>test1/forms.py</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    zhanghu = forms.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    mima = forms.CharField(max_length=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在views里面去实例化表单类,注意,我们是去实例化forms.py里面的LoginForm 然后把实例化的对象login_form 传递给模板 login_test.html 传递的值是 form</p>
<blockquote>
<p>test1/views.py</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test5</span><span class="params">(request)</span>:</span></span><br><span class="line"></span><br><span class="line">	 <span class="keyword">from</span> movies.forms <span class="keyword">import</span> LoginForm</span><br><span class="line">    method = request.method</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">"GET"</span>:</span><br><span class="line">        login_form = LoginForm()</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'test1/login_test.html'</span>,&#123;<span class="string">'form'</span>:login_form&#125;)</span><br><span class="line">    <span class="keyword">elif</span> method == <span class="string">"POST"</span>:</span><br><span class="line">        account = request.POST[<span class="string">'account'</span>]</span><br><span class="line">        password = request.POST[<span class="string">'password'</span>]</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'POST'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在html里面去调用form,以为接受值,因为我们在views.py里面定义就是form,当然我们也可以定义其他的值</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render(request,<span class="string">'test1/login_test.html'</span></span><br><span class="line">,&#123;<span class="string">'form'</span>:login_form&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>templates/movies/login_test.html</p>
</blockquote>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;hi Login!&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">"http://127.0.0.1:18001/login/"</span> </span><br><span class="line">				method=<span class="string">"post"</span>&gt;&#123;&#123; form &#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="项目整体"><a href="#项目整体" class="headerlink" title="项目整体"></a>项目整体</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>安装：</p>
<blockquote>
<p>pip3 install django -i <a href="https://pypi.doubanio.com/simple/" target="_blank" rel="noopener">https://pypi.doubanio.com/simple/</a></p>
</blockquote>
</li>
<li><p>查看：</p>
<blockquote>
<p>django-admin</p>
</blockquote>
</li>
</ul>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><ul>
<li><p>pycharm中可直接创建; 或者命令行：django-admin startproject priject_name</p>
</li>
<li><p>运行Django：python3 manage.py runserver   浏览器打开有小火箭即成功</p>
</li>
<li><p>创建app：python3 manage.py  startapp app_name</p>
</li>
<li><p>pycharm: debug运行  ：edit可设置ip和端口</p>
</li>
</ul>
<h3 id="Django配置"><a href="#Django配置" class="headerlink" title="Django配置"></a>Django配置</h3><ul>
<li>配置目录</li>
</ul>
<blockquote>
<p>与Django一样名字的目录为配置目录</p>
</blockquote>
<blockquote>
<p>urls：各种链接，功能的实现，路由URL    </p>
<blockquote>
<p>1.path(‘地址栏取名’,相关函数)</p>
<p>例如：path(‘hello/‘, views.hello_world) </p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>2.需要使用import调用函数所在文件 调用的为views中的函数</p>
<p>例如：from app1 import views</p>
</blockquote>
<p>settings：</p>
<blockquote>
<p>1.allowed_hosts（允许访问的IP）bug:同一局域网里IP可随意访问</p>
<p>2.templates:模版  ‘dirs’：确认html放置的文件夹</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>例如：’DIRS’: [os.path.join(BASE_DIR, ‘templates’)]<br>            base_dir:该项目的路径</p>
</blockquote>
</blockquote>
<ul>
<li>app操作</li>
</ul>
<blockquote>
<p>自己建立的app包中：</p>
</blockquote>
<blockquote>
<blockquote>
<p>views：创建函数   </p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1.httpresponse函数：创建报文内容 用于return HttpResponse(‘html语句’)  需要使用import导入该函数</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>2.requests参数：创建函数时必须加上该参数，用于接收数据等便于使用 </p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>3.render(re参数,html位置—&gt;直接html名,参数dict) ：将其发送给浏览器</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="文件发送"><a href="#文件发送" class="headerlink" title="文件发送"></a>文件发送</h3><ul>
<li><p>html：</p>
<ul>
<li>创建放置html文件夹</li>
<li>确认文件夹位置：settings 2  templates中</li>
<li>书写html</li>
<li>编写调用函数 views 3</li>
<li>urls增加该网页 urls 1，2</li>
</ul>
</li>
<li><p><code>css/js/images</code>(静态文件访问):</p>
<ul>
<li><p>在编写的html中增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">		&lt;head&gt;中加：</span><br><span class="line">		激活：</span><br><span class="line">             &#123;% load static %&#125;</span><br><span class="line">             自动生成静态文件链接：</span><br><span class="line">	      &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">'&#123;% static "css.css" %&#125;'</span></span><br><span class="line">	      &gt;html中的&#123;&#123;&#125;&#125;&lt;li&gt;&#123;&#123; age &#125;&#125;&lt;/li&gt;</span><br><span class="line">		编写views中的函数内容时可以将&#123;&#123;&#125;&#125;中的参数以dict的形</span><br><span class="line">		式发送过来并替换其中的字段</span><br><span class="line">	```	</span><br><span class="line">	</span><br><span class="line">* 	创建css js文件夹</span><br><span class="line">* 	settings添加：</span><br><span class="line">	&gt;<span class="number">1.</span>设置访问url的路径（网址名）：STATIC_URL = <span class="string">'/static/'</span>	</span><br><span class="line">	&gt;<span class="number">2.</span>确认位置：STATICFILES_DIRS = [os.path.join(BASE_DIR, “html存放路径”),] </span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">* 配置urls:</span><br><span class="line">	</span><br><span class="line">	```python</span><br><span class="line">	 <span class="keyword">from</span> django.conf <span class="keyword">import</span> settings  调用上面的设置</span><br><span class="line">	 <span class="keyword">from</span> django.conf.urls.static <span class="keyword">import</span> static   调用该函数</span><br><span class="line">	 urlpatterns = [</span><br><span class="line">				]+static(settings.STATIC_URL)</span><br></pre></td></tr></table></figure>
</li>
<li><p>书写css js images</p>
</li>
<li><p>浏览器访问：/static/css.css</p>
</li>
<li><p>浏览器访问对应html便可以</p>
</li>
</ul>
</li>
</ul>
<h3 id="数据库连接"><a href="#数据库连接" class="headerlink" title="数据库连接"></a>数据库连接</h3><ul>
<li><p>与settings在相同文件夹下创建：my.cnf普通文件</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my.cnf</span></span><br><span class="line">[client]</span><br><span class="line">database = NAME</span><br><span class="line">user = USER</span><br><span class="line">password = PASSWORD</span><br><span class="line">default-character-set = utf8mb4</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings设置：databases 中将本身数据库配置替换成mysql的配置代码</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">  		<span class="string">'default'</span>: &#123;</span><br><span class="line">   		   <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">    		  <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">    		      <span class="string">'read_default_file'</span>: os.path.join(base_dir,‘django_s’,’my.cnf’),</span><br><span class="line">    		  &#125;,</span><br><span class="line"> 		 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装pymysql : </p>
  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pymsql </span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> pycharm<span class="regexp">/preferences/</span>project.django_s<span class="regexp">/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Django使用mysql：settings同级的<strong>init</strong>中增加代码：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>).__init__中代码：</span><br><span class="line">	<span class="keyword">import</span> pymysql			</span><br><span class="line">	pymysql.version_info(<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>)        </span><br><span class="line">	&lt;—版本报错问题解决 无可不修改</span><br><span class="line">	pymysql.install_as_MySQLdb()</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>).在external library//site-packages/django/db/backends/</span><br><span class="line">mysql/operations</span><br><span class="line"></span><br><span class="line">中将与下面<span class="number">5</span> <span class="number">1</span>对应修改<span class="number">146</span>行  </span><br><span class="line">可以先运行会自定跳到该错误这里修改即可</span><br><span class="line"></span><br><span class="line">last_executed_query中query.decode改成encode</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><ul>
<li><p>命令行：在manage.py同级目录下执行</p>
<blockquote>
<p>python3 manage.py migrate   —&gt;在mysql中直接创建django内置的表 </p>
</blockquote>
<blockquote>
<p>(1).出现’decode’:在 external library/python 3.7/site-packages/django/db/        backends/mysql/operationslast_executed_query中query.decode改成encode          (直接vim修改)</p>
</blockquote>
</li>
<li><p>orm:通过对象操作数据库</p>
<ul>
<li><p>在views同级的models.py中编写定义自己的数据库表：即class创建</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">例如：创建一个文章发布的数据库</span><br><span class="line">	score = models.FloatField(default = <span class="number">0</span>,verbose_name=‘电影评分’)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	title = models.CharField(max_length=<span class="number">255</span>)  <span class="comment">#文章标题</span></span><br><span class="line">	punish_time = models.DateTimeField()  <span class="comment">#文章发布时间</span></span><br><span class="line">	author = models.CharField(max_length=<span class="number">20</span>) <span class="comment">#文章作者</span></span><br><span class="line">	text = models.CharField(max_length=<span class="number">2000</span>)  <span class="comment">#文章内容</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.title       </span><br><span class="line">		(admin中直接以title字段显示)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在settings：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">installed_apps=[‘添加自己创建的app,即views所在文件夹名’</span><br><span class="line">		例：’app1’]</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成数据库表：命令行执行：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>python3 manage.py makemigrations   </span><br><span class="line"> (会在migrations文件夹下生成一个数据库迁移文件) </span><br><span class="line"><span class="number">2.</span>python3 manage.py migrate     </span><br><span class="line">（根据（<span class="number">3</span>）生成的建表文件在数据库中建表）</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：1执行成功的迁移文件会在数据库中django_migrations表中也创建一个该记录必须同时存在才行 不然会一直报错：table</p>
</blockquote>
<blockquote>
<p>解决：（1）删除migrations中的相关文件 再删除数据库表中的对应的记录 重新执行上述两个命令</p>
</blockquote>
</li>
<li><p>数据库表数据读取并在html中显示出来：</p>
<blockquote>
<p>1.创建html相关网页</p>
</blockquote>
<blockquote>
<p>2.views：创建函数提取：引入models中的相关class  即2(1)中创建的相关表的类名from app1.models import Article</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">编写发送函数：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">article</span><span class="params">(requests)</span>:</span></span><br><span class="line">	<span class="comment">#相当于select * from article where id = 1 </span></span><br><span class="line">	语句（并未执行）：</span><br><span class="line">	data = Article.objects.filter(id=<span class="number">1</span>)</span><br><span class="line">	<span class="comment">#切片执行该语句：</span></span><br><span class="line">	res = data[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> render(requests,’article.html’,</span><br><span class="line">				&#123;html中&#123;&#123;&#125;&#125;&#125;的对应值dict&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置urls ：与上面urls配置一样 先导入再添加</p>
</li>
</ul>
<h3 id="admin用户创建"><a href="#admin用户创建" class="headerlink" title="admin用户创建"></a>admin用户创建</h3><ul>
<li><p>命令行：</p>
<blockquote>
<p>python3 manage.py createsuperuser  (本次设置user:wangqi password:wang1995)</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>添加数据库到admin</p>
<ul>
<li><p>admin文件中添加代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 导入models中创建的数据库类名：</span><br><span class="line"> <span class="keyword">from</span> app1.models <span class="keyword">import</span> Article</span><br><span class="line">添加到admin中：</span><br><span class="line"><span class="meta">@admin.register(Article)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器中进入admin即有自己创建的数据库，可以进行相关插入等操作</p>
</li>
</ul>
</li>
</ul>
<h2 id="外部app-或者html"><a href="#外部app-或者html" class="headerlink" title="外部app(或者html)"></a>外部app(或者html)</h2><h3 id="在django文件夹下："><a href="#在django文件夹下：" class="headerlink" title="在django文件夹下："></a>在django文件夹下：</h3><blockquote>
<p>python3 manage.py startapp ‘名字’  创建新的app</p>
<p>先运行 python3 manage.py rumserver  确定Django开启成功</p>
</blockquote>
<h3 id="将其外部的网页代码放入django-项目下"><a href="#将其外部的网页代码放入django-项目下" class="headerlink" title="将其外部的网页代码放入django 项目下"></a>将其外部的网页代码放入django 项目下</h3><ul>
<li><p>配置路径 </p>
<blockquote>
<p>settings installed_apps添加该app名 templates:添加html存放路径<br>  在最后添加存放静态文件（html中的css/js）的代码以及媒体文件的media路径（见下）</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>配置urls  先连接index.html看是否成功</p>
</li>
<li><p>设置css/js/images</p>
<blockquote>
<p>1) python中 提供 <code>win+r</code> 可以查询+替换修改代码中的相关代码  </p>
<p>2) 在使用正则表达式时需要勾选Regex  </p>
<p>3) 查询：<code>(css/.*\.css)</code>  加括号表示一个整体<code>\</code> 转译     </p>
<p>4) 替换：</p>
</blockquote>
</li>
<li><p>建立数据库:</p>
<blockquote>
<p>1)modele:建表 + 命令行操作数据库链接</p>
</blockquote>
<blockquote>
<p>2)admin建立后台</p>
</blockquote>
<blockquote>
<p>3)settings设置路径 databases添加数据库my.cnf文件位置</p>
</blockquote>
<blockquote>
<p>4)views添加查询和插入函数将切片转到html代码中去：</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">html中循环：`&#123;% <span class="keyword">for</span> %&#125;循环代码&#123;% endear %&#125;`				</span><br><span class="line">例如</span><br><span class="line">views:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_movie</span><span class="params">(requests)</span>:</span></span><br><span class="line">	data = Movie.objects.all()</span><br><span class="line">	<span class="keyword">return</span> render(requests, <span class="string">'index.html'</span></span><br><span class="line">	&#123;‘data’:data&#125;</span><br><span class="line">html：</span><br><span class="line">	&#123;% <span class="keyword">for</span> movie <span class="keyword">in</span> data %&#125;</span><br><span class="line">	&lt;li&gt;&lt;p class='title'&gt;&#123;&#123; movie.title &#125;&#125;&lt;/p&gt;&lt;/li&gt;</span><br><span class="line">	&#123;% endfor %&#125;</span><br><span class="line">模版中切片：</span><br><span class="line">	&#123;% <span class="keyword">for</span> movie <span class="keyword">in</span> data |slice:<span class="string">"0:5"</span>%&#125;取前<span class="number">5</span>个</span><br><span class="line"></span><br><span class="line">url建立连接</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h3><ul>
<li><p>models:添加字段：</p>
<blockquote>
<p>img = models.ImageField(upload_to=’images’,verbose_name=’电影图片’)再执行数据库操作2（3）</p>
</blockquote>
<blockquote>
<p>注意 ：进行3第一步时会跳出选择：</p>
<p>1.后续更改 先创建 2.退出,先添加 选择1 然后随便添加内容回车html中修改图片的链接</p>
</blockquote>
</li>
</ul>
<h3 id="html中使用自定义函数"><a href="#html中使用自定义函数" class="headerlink" title="html中使用自定义函数"></a>html中使用自定义函数</h3><ul>
<li><p>函数模版：</p>
<blockquote>
<p>在app中建立一个目录：名字固定：templatetags  其中包含<strong>init</strong>文件</p>
<pre><code>创建一个功能名.py文件</code></pre></blockquote>
<blockquote>
<p>在该.py中自定义函数编写：</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">模版：</span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line">register = template.Library()</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.filter(name = ‘count_star’)  </span></span><br><span class="line"><span class="comment">#计算星星数量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_star</span><span class="params">(value)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> range(math.floor(value))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在需要该函数的html中装载：{% load 功能名 %}</p>
</blockquote>
</li>
</ul>
<h3 id="媒体文件访问"><a href="#媒体文件访问" class="headerlink" title="媒体文件访问"></a>媒体文件访问</h3><ul>
<li><p>图片以及视频与静态文件分开：</p>
<blockquote>
<p>(1)创建图片视频等存放文件夹</p>
</blockquote>
<blockquote>
<p>(2)settings : </p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">templates添加：</span><br><span class="line"></span><br><span class="line">django.template.context_processors.media</span><br><span class="line">最后添加：<span class="comment">#代表媒体文件的存储路径</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR,<span class="string">'media'</span>)  </span><br><span class="line"><span class="comment">#指定后 其媒体文件根目录为media</span></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)urls：</p>
</blockquote>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">调用re_path 使用正则表达式</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path</span><br><span class="line"><span class="keyword">from</span> django.views.static <span class="keyword">import</span> serve</span><br><span class="line"><span class="keyword">from</span> p1904_django2.settings <span class="keyword">import</span> MEDIA_ROOT,MEDIA_URL</span><br><span class="line"></span><br><span class="line">urlpatterns添加：</span><br><span class="line">	 re_path(<span class="string">r'^media/(?P&lt;path&gt;.*)$'</span>, serve, </span><br><span class="line">	 			&#123;<span class="string">'document_root'</span>:MEDIA_ROOT&#125;),</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)html:</p>
</blockquote>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">装载：</span><span class="template-tag">&#123;% <span class="name"><span class="name">load</span></span> movie_extras %&#125;</span><span class="xml"> </span></span><br><span class="line"></span><br><span class="line"><span class="xml">替换所有img:</span><span class="template-tag">&#123;% <span class="name"><span class="name">static</span></span>  movie.img.url %&#125;</span><span class="xml">    </span></span><br><span class="line"><span class="xml">		\&#123; % static  '(images/.*\.jpg)' %\&#125;</span></span><br><span class="line"><span class="xml">		</span></span><br><span class="line"><span class="xml">替换成： </span><span class="template-variable">&#123;&#123; MEDIA_URL &#125;&#125;</span><span class="xml">images/m15.jpg     </span></span><br><span class="line"><span class="xml">		\&#123; MEDIA_URL &#125;&#125;$1以及：</span><span class="template-variable">&#123;&#123; movie.img.url &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(5)models：</p>
</blockquote>
<blockquote>
<p>修改img的存储结构（路径格式）其媒体跟目录为media 只需要在这个跟目录下创建images文件用来存放媒体文件即可</p>
</blockquote>
</li>
</ul>
<h3 id="登陆-注册-退出"><a href="#登陆-注册-退出" class="headerlink" title="登陆 注册 退出"></a>登陆 注册 退出</h3><ul>
<li><p>django 自带用户表  auth_user :password   pbkdf2_sha256$150000$   使用sha256加密了150000次使用该表并使用orm继承并扩展</p>
</li>
<li><p>建立一个用户单独的app python3 manage.py startalp users    (django官网：documentation 查询user有步骤)</p>
</li>
<li><p>用户models 中 </p>
<blockquote>
<p>from django.contrib.auth.models import AbstractUser   #在用户app中继承用户模型</p>
</blockquote>
<blockquote>
<p>class UserInfo(Abstract..)</p>
</blockquote>
</li>
<li><p>添加app到 settings：确认其修改</p>
<blockquote>
<p>INS.._APP添加：users</p>
</blockquote>
<blockquote>
<p>AUTH_USER_MODEL = ‘users.UserInfo’</p>
</blockquote>
</li>
<li><p>命令行执行：数据库迁移  </p>
<blockquote>
<p>执行时会出问题：用户表在数据库中存在，删除不了</p>
</blockquote>
<blockquote>
<p>解决办法：在Django之前就创建好上诉继承代码 若已经创建 直接删除所有表然后再python3 manage两步  再创建命令行超级用户</p>
</blockquote>
</li>
<li><p>注册功能：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">	views：导入数据库models中创建表类名</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(requests)</span>:</span><span class="keyword">pass</span>   </span><br><span class="line">	</span><br><span class="line">	UserInfo.objects.create_user(username=</span><br><span class="line">			requ.POST[‘username’],password=..)  			</span><br><span class="line">			creat_user:可在生成名字时就会生成密码			</span><br><span class="line">			<span class="keyword">return</span> HttpResponse(‘hello’) <span class="comment">#检测链接</span></span><br><span class="line">				</span><br><span class="line">	出现CSRF验证：settings中middleware中注销掉Csrf  </span><br><span class="line">				     </span><br><span class="line">	urls：添加该函数到path网页中找到注册表单—html中找到相应位置 </span><br><span class="line">	修改action http://ip/register函数所有表单信息便传到该函</span><br><span class="line">	数的requests中</span><br><span class="line">	```	</span><br><span class="line"></span><br><span class="line">* 登陆功能：</span><br><span class="line">		</span><br><span class="line">	```python</span><br><span class="line">	views：</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(re..)</span>:</span></span><br><span class="line">		username = re…POST[‘username’]</span><br><span class="line">		password = re…POST[‘ps’]</span><br><span class="line">		user = UserInfo.objects.filter(username=username)[<span class="number">0</span>] </span><br><span class="line">		<span class="comment">#数据库查询语句 查询用户表中username密码</span></span><br><span class="line">		check_password 函数(需要导入)： 检测密码</span><br><span class="line">		<span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">		注意：表单形式的验证前后端需要同时做：</span><br><span class="line">		例如：密码验证需要前后端都同时做</span><br><span class="line">		前端：html：min_length = ‘<span class="number">4</span>’   </span><br><span class="line">		（这里设置后，如果后端没改，前端网页里的限制条件仍然可以改，</span><br><span class="line">		因其html保存在本地的，在elements中可以修改，相当于漏洞）</span><br><span class="line">		</span><br><span class="line">		后端：<span class="keyword">if</span> leng(‘username’) &lt; <span class="number">4</span>:</span><br><span class="line">			<span class="keyword">return</span> HttpResponse(‘用户名长度必须大于<span class="number">4</span>’)</span><br><span class="line">	```	</span><br><span class="line"></span><br><span class="line">* <span class="number">7.</span>登陆注册只用后端做的方法</span><br><span class="line">			</span><br><span class="line">	```python</span><br><span class="line">	forms模块(表单渲染 生成表单和验证表单 生成表单属于index中的  </span><br><span class="line">			解决<span class="number">6</span>中注意)  </span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(forms.Form)</span></span></span><br><span class="line"><span class="class">	<span class="title">charfield</span>:</span>数据库中为varchar()   </span><br><span class="line">	html:type元素    app中创建forms.py文件</span><br><span class="line">	</span><br><span class="line">	导入forms模块  :</span><br><span class="line">		与创建module一样创建相关<span class="class"><span class="keyword">class</span>，比如登陆表单的<span class="title">input</span>字段等</span></span><br><span class="line"><span class="class">		密码字段定义：</span></span><br><span class="line">		password = forms.CharField(min_length =8, widget </span><br><span class="line">				=forms.PasswordInput)  </span><br><span class="line">				将type中改成password邮箱字段:EmailField</span><br><span class="line">		网址字段:urlfiled</span><br><span class="line">		views:添加该相关函数的值到html调用函数中进行实例化，</span><br><span class="line">		f = LoginForm()   表示在html中生成表单</span><br><span class="line">			</span><br><span class="line">		html:在form表单中直接使用该字段</span><br><span class="line">		</span><br><span class="line">		验证表单：</span><br><span class="line">		users app中</span><br><span class="line">		导入表单</span><br><span class="line">		f = LoginForm(requests.POST)    </span><br><span class="line">		print(f.is_valid())  :ture false    </span><br><span class="line">		表示该表单符合创建表单其中的字段限制</span><br><span class="line">		username = f.cleaned_data[‘username’]    </span><br><span class="line">		从cleaned中取html中验证成功的相关字段（与form表单中的字</span><br><span class="line">								段名需要一致）用户不存在:<span class="keyword">try</span></span><br><span class="line"></span><br><span class="line">	ModelForm模块（与数据库相连，比上面更好,可以以数据库中字段创建表）：  </span><br><span class="line">	forms.py:</span><br><span class="line">		<span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> get_user_model  </span><br><span class="line">		<span class="comment">#获取user的数据库信息  类</span></span><br><span class="line">				</span><br><span class="line">		User = get_user_model()			</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">UserForm</span><span class="params">(forms.ModelForm)</span>:</span>      <span class="comment">#</span></span><br><span class="line">			<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> </span><br><span class="line">				model = User      <span class="comment">#创建用户模版</span></span><br><span class="line">				fields = (“username”, “password”)    </span><br><span class="line">				<span class="comment">#需要验证的字段</span></span><br><span class="line">				<span class="comment">#选择需要修改的字段</span></span><br><span class="line">				widgets = &#123; </span><br><span class="line">					‘password’: forms.PasswordInput(</span><br><span class="line">					attrs=&#123;“min_length”:<span class="number">8</span>&#125;),     </span><br><span class="line">					<span class="comment">#设置最小长度 （数据库中该字段只有max_length）</span></span><br><span class="line">					‘username’: forms.TextInput(attrs=&#123;“</span><br><span class="line">						min_length”:<span class="number">4</span>,‘<span class="class"><span class="keyword">class</span>’:</span> text&#125;)  </span><br><span class="line">					<span class="comment">#启动class字段	&#125;</span></span><br><span class="line">			html/views：</span><br><span class="line">			users/views:</span><br><span class="line">			登陆注意:is_valid()函数会验证在数据库中是否存在，</span><br><span class="line">					需要在上述中将该方法在上面类下重写方法  </span><br><span class="line">					<span class="function"><span class="keyword">def</span> <span class="title">validate_unique</span><span class="params">(self)</span>:</span><span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>保持登陆： Django中的login方法  </p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">引用：</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> login <span class="keyword">as</span> user_login </span><br><span class="line">在登陆函数中</span><br><span class="line">users/views/login:check_password </span><br><span class="line">正确后：</span><br><span class="line">user_login(requests, user) </span><br><span class="line">将该user加到报文中，并在html中保存为session以及数据库中保存在</span><br><span class="line">登陆页面（index.html）：</span><br><span class="line">加入判断语句：</span><br><span class="line">&#123;% <span class="keyword">if</span> <span class="keyword">not</span> requests.user.is_authenticated %&#125; </span><br><span class="line">判断是否登陆，以此返回不同的标签 &#123;% <span class="keyword">else</span> %&#125;&#123;% endif %&#125; </span><br><span class="line">以此保持登陆</span><br><span class="line">		</span><br><span class="line">退出：</span><br><span class="line">loginout模块</span><br><span class="line">	user/views: </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">logout</span>:</span>user_logout(requests) </span><br><span class="line">		<span class="keyword">return</span> HttpResponse(‘logout success’)</span><br><span class="line">		</span><br><span class="line">--urls--中配置</span><br><span class="line">			html中加入到相关href中</span><br><span class="line">			urls:可以设置别名：name=‘’    </span><br><span class="line">			相应href 中可以使用&#123;% -url- ‘别名’ %&#125;  </span><br><span class="line">			可以把固定地址换成与后台同步</span><br><span class="line">	</span><br><span class="line">		跳转页面		</span><br><span class="line">		<span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect	</span><br><span class="line">		<span class="keyword">from</span> django.urls </span><br><span class="line">		<span class="keyword">return</span> redirect(‘http// …’)</span><br><span class="line">		<span class="keyword">return</span> redirect(‘别名’)</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>评分：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">	新建评分app</span><br><span class="line">settings：添加app</span><br><span class="line">新建model：导入models Movie get_user_model 模块</span><br><span class="line">	User = get_user_model</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Score</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">		tags = ((<span class="number">1</span>, ‘aa’),(<span class="number">2</span>,’bb’),)</span><br><span class="line">		movie_score = models.Int..(choices=tags)  </span><br><span class="line">		选择分数</span><br><span class="line">		movie = models.ForieginKey(‘movie.Movie’, </span><br><span class="line">					on_delete=models.CASCADE)   </span><br><span class="line">		删除的方式</span><br><span class="line">		user = models.<span class="keyword">for</span>…key(‘users.UserInfo, ..’)</span><br><span class="line">	</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">			unique_together = (‘movie’, ‘user’)  唯一</span><br><span class="line">	</span><br><span class="line">注意：字段不能与相关联表的字段重合</span><br><span class="line">	</span><br><span class="line">命令行创建数据库表	</span><br><span class="line">	</span><br><span class="line">修改之前自定义打星函数：</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署：将本地代码放到云服务器以便所有人都可以访问</p>
</li>
</ul>
<pre><code><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>服务器</span><br><span class="line"><span class="number">2.</span>登陆部署电脑：ssh <span class="symbol">rimi@</span><span class="number">10.2</span><span class="number">.0</span><span class="number">.26</span></span><br><span class="line"><span class="number">3.</span>本地上传代码到 git 再在部署电脑上拷贝下来</span><br><span class="line"><span class="number">4.</span> 部署机：安装django, 注意版本号</span><br><span class="line"><span class="number">5.</span>输出本地关于oython3的所有包版本号:pip3 freeze &gt; requirements.txt</span><br><span class="line"><span class="number">6.</span>服务器:pip3 install -r requirements.txt</span><br><span class="line"><span class="number">7.</span> 启动 <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span> 所有人都可以访问（测试用）gunicorn(上线)</span><br><span class="line"><span class="number">8.</span>gunicorn:    安装   线程数量：cpu*<span class="number">2</span> +<span class="number">1</span>   进程 = 线程/<span class="number">2</span>   </span><br><span class="line"><span class="number">9.</span>启动：wigs: scoket 接收http协议    需要将python的socket替换成wigs</span><br><span class="line"><span class="number">10.</span>访问日志/报错</span><br><span class="line"><span class="number">11.</span>图片美化  分类搜索  活动  后台分类（分级）</span><br></pre></td></tr></table></figure></code></pre>
      
    </div>
    
    
    

    <div>
 	 
   	 <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

 	 
    </div>

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/05/03/Django%E7%BB%BC%E8%BF%B0/">Django综述</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Jwang 的个人博客">Jwang</a></p>
  <p><span>发布时间:</span>2019年05月03日 - 18:05</p>
  <p><span>最后更新:</span>2020年03月05日 - 17:03</p>
  <p><span>原始链接:</span><a href="/2019/05/03/Django%E7%BB%BC%E8%BF%B0/" title="Django综述">https://github.com/learn666-gif/2019/05/03/Django%E7%BB%BC%E8%BF%B0/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://github.com/learn666-gif/2019/05/03/Django%E7%BB%BC%E8%BF%B0/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
	  $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
	});
    });  
</script>


      
    </div>    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/03/mysql%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/" rel="next" title="mysql由浅入深">
                <i class="fa fa-chevron-left"></i> mysql由浅入深
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/04/HTML%E7%BB%BC%E8%BF%B0/" rel="prev" title="HTML综述">
                HTML综述 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODg5NC8yNTM4OA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Jwang" />
            
              <p class="site-author-name" itemprop="name">Jwang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/learn666-gif" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/684433bc744b" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-heartbeat"></i>简书</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qq_34536604" target="_blank" title="csdn">
                      
                        <i class="fa fa-fw fa-crosshairs"></i>csdn</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/5e5c685e6fb9a07cd443bedai" target="_blank" title="掘金">
                      
                        <i class="fa fa-fw fa-spinner"></i>掘金</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://app.gitbook.com/@79896867/spaces" target="_blank" title="gitbook">
                      
                        <i class="fa fa-fw fa-git"></i>gitbook</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.uisdc.com/" title="优设" target="_blank">优设</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://ife.baidu.com/" title="百度前端技术学院" target="_blank">百度前端技术学院</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟环境安装"><span class="nav-number">2.</span> <span class="nav-text">虚拟环境安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过django创建第一个app"><span class="nav-number">2.2.</span> <span class="nav-text">通过django创建第一个app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么使用1-11版本"><span class="nav-number">2.3.</span> <span class="nav-text">为什么使用1.11版本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apps详解"><span class="nav-number">3.</span> <span class="nav-text">apps详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#apps和整体配置文件内部结构"><span class="nav-number">3.1.</span> <span class="nav-text">apps和整体配置文件内部结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第一个简单页面"><span class="nav-number">3.2.</span> <span class="nav-text">第一个简单页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解释"><span class="nav-number">3.3.</span> <span class="nav-text">解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二个页面"><span class="nav-number">3.4.</span> <span class="nav-text">第二个页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解释-1"><span class="nav-number">3.5.</span> <span class="nav-text">解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三个页面"><span class="nav-number">3.6.</span> <span class="nav-text">第三个页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解释-2"><span class="nav-number">3.7.</span> <span class="nav-text">解释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mtv模式"><span class="nav-number">4.</span> <span class="nav-text">mtv模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解释-3"><span class="nav-number">4.1.</span> <span class="nav-text">解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#综述"><span class="nav-number">4.2.</span> <span class="nav-text">综述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数视图"><span class="nav-number">5.</span> <span class="nav-text">函数视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基础视图分析"><span class="nav-number">5.1.</span> <span class="nav-text">基础视图分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#快捷函数"><span class="nav-number">5.2.</span> <span class="nav-text">快捷函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#装饰器"><span class="nav-number">5.3.</span> <span class="nav-text">装饰器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类视图"><span class="nav-number">5.4.</span> <span class="nav-text">类视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRF"><span class="nav-number">6.</span> <span class="nav-text">CSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF概念"><span class="nav-number">6.1.</span> <span class="nav-text">CSRF概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF攻击攻击原理及过程"><span class="nav-number">6.2.</span> <span class="nav-text">CSRF攻击攻击原理及过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF攻击实例"><span class="nav-number">6.3.</span> <span class="nav-text">CSRF攻击实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#防御CSRF攻击"><span class="nav-number">6.4.</span> <span class="nav-text">防御CSRF攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Form表单"><span class="nav-number">7.</span> <span class="nav-text">Form表单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#作用"><span class="nav-number">7.1.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成表单"><span class="nav-number">7.2.</span> <span class="nav-text">生成表单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目整体"><span class="nav-number">8.</span> <span class="nav-text">项目整体</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-1"><span class="nav-number">8.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建项目"><span class="nav-number">8.2.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django配置"><span class="nav-number">8.3.</span> <span class="nav-text">Django配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件发送"><span class="nav-number">8.4.</span> <span class="nav-text">文件发送</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库连接"><span class="nav-number">8.5.</span> <span class="nav-text">数据库连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库操作"><span class="nav-number">8.6.</span> <span class="nav-text">数据库操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#admin用户创建"><span class="nav-number">8.7.</span> <span class="nav-text">admin用户创建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#外部app-或者html"><span class="nav-number">9.</span> <span class="nav-text">外部app(或者html)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在django文件夹下："><span class="nav-number">9.1.</span> <span class="nav-text">在django文件夹下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将其外部的网页代码放入django-项目下"><span class="nav-number">9.2.</span> <span class="nav-text">将其外部的网页代码放入django 项目下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片处理"><span class="nav-number">9.3.</span> <span class="nav-text">图片处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html中使用自定义函数"><span class="nav-number">9.4.</span> <span class="nav-text">html中使用自定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#媒体文件访问"><span class="nav-number">9.5.</span> <span class="nav-text">媒体文件访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#登陆-注册-退出"><span class="nav-number">9.6.</span> <span class="nav-text">登陆 注册 退出</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jwang</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<!-- 
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->


<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共134.4k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
   i </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
